<!-- Users List Component -->
<div class="users-page">
    <!-- Page Header -->
    <header class="page-header">
        <div class="header-content">
            <nav class="breadcrumb">
                <span>System Settings</span>
                <i class="fas fa-chevron-right"></i>
                <span class="current">User Management</span>
            </nav>
            <h1 class="page-title">User Management</h1>
            <p class="page-subtitle">Manage organization staff, roles, and system access levels.</p>
        </div>
        <button class="btn-primary" routerLink="create">
            <i class="fas fa-plus"></i>
            Add New User
        </button>
    </header>

    <!-- Navigation Tabs -->
    <nav class="page-tabs">
        <a class="tab active" routerLink="/users" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}">
            <i class="fas fa-users"></i>
            Users
        </a>
        <a class="tab" routerLink="/users/roles" routerLinkActive="active">
            <i class="fas fa-user-shield"></i>
            Roles & Permissions
        </a>
    </nav>

    <!-- Filters Section -->
    <section class="filters-section">
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="Search by name, email, or department..." [ngModel]="searchTerm()"
                (ngModelChange)="searchTerm.set($event)" (keyup.enter)="onSearch()">
        </div>

        <div class="filter-group">
            <div class="filter-dropdown">
                <select [ngModel]="selectedRole()" (ngModelChange)="onRoleChange($event)">
                    <option value="all">Role: All</option>
                    @for (role of roles(); track role.id) {
                    <option [value]="role.name">{{ role.name }}</option>
                    }
                </select>
                <i class="fas fa-chevron-down"></i>
            </div>

            <div class="filter-dropdown">
                <select [ngModel]="selectedStatus()" (ngModelChange)="onStatusChange($event)">
                    <option value="all">Status: All</option>
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                </select>
                <i class="fas fa-chevron-down"></i>
            </div>

            <button class="btn-reset" (click)="resetFilters()">
                <i class="fas fa-undo"></i>
                Reset
            </button>
        </div>
    </section>

    <!-- Users Table -->
    <section class="users-table-section">
        @if (loading()) {
        <div class="loading-state">
            <div class="spinner"></div>
            <span>Loading users...</span>
        </div>
        } @else {
        <table class="users-table">
            <thead>
                <tr>
                    <th>User</th>
                    <th>Department & Role</th>
                    <th>Status</th>
                    <th>Last Login</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @for (user of users(); track user.id) {
                <tr>
                    <td class="user-cell">
                        <div class="user-avatar">
                            @if (user.profileImageUrl) {
                            <img [src]="getAvatarUrl(user)" [alt]="user.fullName">
                            } @else {
                            <span class="avatar-initials">{{ user.initials }}</span>
                            }
                        </div>
                        <div class="user-info">
                            <span class="user-name">{{ user.fullName }}</span>
                            <span class="user-email">{{ user.email }}</span>
                        </div>
                    </td>
                    <td class="role-cell">
                        <span class="department">{{ user.primaryRole }}</span>
                        <span class="role-badge" [class]="user.roleClass">{{ user.primaryRole }}</span>
                    </td>
                    <td>
                        <span class="status-badge" [class]="user.statusClass">
                            <span class="status-dot"></span>
                            {{ user.statusLabel }}
                        </span>
                    </td>
                    <td class="date-cell">
                        {{ formatDate(user.lastLoginAt) }}
                    </td>
                    <td class="actions-cell">
                        <button class="action-btn" title="View" [routerLink]="[user.id]">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn" title="Edit" [routerLink]="['edit', user.id]">
                            <i class="fas fa-pen"></i>
                        </button>
                        <button class="action-btn toggle" [title]="user.isActive ? 'Deactivate' : 'Activate'"
                            (click)="toggleUserStatus(user)">
                            <i class="fas" [class.fa-toggle-on]="user.isActive"
                                [class.fa-toggle-off]="!user.isActive"></i>
                        </button>
                        <button class="action-btn delete" title="Delete" (click)="deleteUser(user)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
                } @empty {
                <tr class="empty-state">
                    <td colspan="5">
                        <div class="empty-content">
                            <i class="fas fa-users-slash"></i>
                            <p>No users found</p>
                            <span>Try adjusting your search or filters</span>
                        </div>
                    </td>
                </tr>
                }
            </tbody>
        </table>
        }
    </section>

    <!-- Pagination -->
    <footer class="pagination-section">
        <span class="results-info">Showing {{ users().length }} users</span>
        <div class="pagination">
            <button class="page-btn" [disabled]="currentPage() === 1" (click)="onPageChange(currentPage() - 1)">
                <i class="fas fa-chevron-left"></i>
            </button>
            <span class="page-number active">{{ currentPage() }}</span>
            <button class="page-btn" (click)="onPageChange(currentPage() + 1)">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </footer>
</div>
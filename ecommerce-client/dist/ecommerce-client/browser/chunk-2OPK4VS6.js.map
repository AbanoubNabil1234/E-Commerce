{
  "version": 3,
  "sources": ["src/app/features/users/services/user-management.service.ts"],
  "sourcesContent": ["// ==============================================\r\n// User Management Service\r\n// ==============================================\r\n\r\nimport { Injectable, inject, signal } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Observable, tap, map } from 'rxjs';\r\nimport { environment } from '../../../../environments/environment';\r\nimport {\r\n    UserDto,\r\n    UserListDto,\r\n    CreateUserDto,\r\n    UpdateUserDto,\r\n    AssignRolesToUserDto,\r\n    ResetUserPasswordDto,\r\n    RoleDto,\r\n    RoleListDto,\r\n    CreateRoleDto,\r\n    UpdateRoleDto,\r\n    AssignPermissionsToRoleDto,\r\n    PermissionDto,\r\n    PermissionGroupDto,\r\n    UserDisplay\r\n} from '../models/user.models';\r\n\r\n@Injectable({\r\n    providedIn: 'root'\r\n})\r\nexport class UserManagementService {\r\n    private http = inject(HttpClient);\r\n    private apiUrl = environment.apiUrl;\r\n\r\n    // Signals for reactive state\r\n    private _users = signal<UserListDto[]>([]);\r\n    private _selectedUser = signal<UserDto | null>(null);\r\n    private _roles = signal<RoleListDto[]>([]);\r\n    private _selectedRole = signal<RoleDto | null>(null);\r\n    private _permissions = signal<PermissionDto[]>([]);\r\n    private _permissionGroups = signal<PermissionGroupDto[]>([]);\r\n    private _loading = signal(false);\r\n\r\n    // Public readonly signals\r\n    users = this._users.asReadonly();\r\n    selectedUser = this._selectedUser.asReadonly();\r\n    roles = this._roles.asReadonly();\r\n    selectedRole = this._selectedRole.asReadonly();\r\n    permissions = this._permissions.asReadonly();\r\n    permissionGroups = this._permissionGroups.asReadonly();\r\n    loading = this._loading.asReadonly();\r\n\r\n    // ==========================================\r\n    // User Operations\r\n    // ==========================================\r\n\r\n    getUsers(page = 1, pageSize = 20, search?: string): Observable<UserListDto[]> {\r\n        this._loading.set(true);\r\n        let params = new HttpParams()\r\n            .set('page', page)\r\n            .set('pageSize', pageSize);\r\n\r\n        if (search) {\r\n            params = params.set('search', search);\r\n        }\r\n\r\n        return this.http.get<UserListDto[]>(`${this.apiUrl}/users`, { params }).pipe(\r\n            tap({\r\n                next: (users) => {\r\n                    this._users.set(users);\r\n                    this._loading.set(false);\r\n                },\r\n                error: () => this._loading.set(false)\r\n            })\r\n        );\r\n    }\r\n\r\n    getUserById(id: string): Observable<UserDto> {\r\n        return this.http.get<UserDto>(`${this.apiUrl}/users/${id}`).pipe(\r\n            tap(user => this._selectedUser.set(user))\r\n        );\r\n    }\r\n\r\n    createUser(dto: CreateUserDto): Observable<UserDto> {\r\n        return this.http.post<UserDto>(`${this.apiUrl}/users`, dto);\r\n    }\r\n\r\n    updateUser(id: string, dto: UpdateUserDto): Observable<UserDto> {\r\n        return this.http.put<UserDto>(`${this.apiUrl}/users/${id}`, dto);\r\n    }\r\n\r\n    deleteUser(id: string): Observable<void> {\r\n        return this.http.delete<void>(`${this.apiUrl}/users/${id}`);\r\n    }\r\n\r\n    assignRoles(userId: string, dto: AssignRolesToUserDto): Observable<UserDto> {\r\n        return this.http.post<UserDto>(`${this.apiUrl}/users/${userId}/roles`, dto);\r\n    }\r\n\r\n    resetPassword(userId: string, dto: ResetUserPasswordDto): Observable<void> {\r\n        return this.http.post<void>(`${this.apiUrl}/users/${userId}/reset-password`, dto);\r\n    }\r\n\r\n    toggleUserStatus(userId: string): Observable<void> {\r\n        return this.http.post<void>(`${this.apiUrl}/users/${userId}/toggle-status`, {});\r\n    }\r\n\r\n    // ==========================================\r\n    // Role Operations\r\n    // ==========================================\r\n\r\n    getRoles(): Observable<RoleListDto[]> {\r\n        return this.http.get<RoleListDto[]>(`${this.apiUrl}/roles`).pipe(\r\n            tap(roles => this._roles.set(roles))\r\n        );\r\n    }\r\n\r\n    getRoleById(id: string): Observable<RoleDto> {\r\n        return this.http.get<RoleDto>(`${this.apiUrl}/roles/${id}`).pipe(\r\n            tap(role => this._selectedRole.set(role))\r\n        );\r\n    }\r\n\r\n    createRole(dto: CreateRoleDto): Observable<RoleDto> {\r\n        return this.http.post<RoleDto>(`${this.apiUrl}/roles`, dto);\r\n    }\r\n\r\n    updateRole(id: string, dto: UpdateRoleDto): Observable<RoleDto> {\r\n        return this.http.put<RoleDto>(`${this.apiUrl}/roles/${id}`, dto);\r\n    }\r\n\r\n    deleteRole(id: string): Observable<void> {\r\n        return this.http.delete<void>(`${this.apiUrl}/roles/${id}`);\r\n    }\r\n\r\n    assignPermissions(roleId: string, dto: AssignPermissionsToRoleDto): Observable<RoleDto> {\r\n        return this.http.post<RoleDto>(`${this.apiUrl}/roles/${roleId}/permissions`, dto);\r\n    }\r\n\r\n    // ==========================================\r\n    // Permission Operations\r\n    // ==========================================\r\n\r\n    getPermissions(): Observable<PermissionDto[]> {\r\n        return this.http.get<PermissionDto[]>(`${this.apiUrl}/permissions`).pipe(\r\n            tap(permissions => this._permissions.set(permissions))\r\n        );\r\n    }\r\n\r\n    getPermissionsGrouped(): Observable<PermissionGroupDto[]> {\r\n        return this.http.get<PermissionGroupDto[]>(`${this.apiUrl}/permissions/grouped`).pipe(\r\n            tap(groups => this._permissionGroups.set(groups))\r\n        );\r\n    }\r\n\r\n    // ==========================================\r\n    // Helper Methods\r\n    // ==========================================\r\n\r\n    mapToUserDisplay(user: UserListDto): UserDisplay {\r\n        const names = user.fullName.split(' ');\r\n        const initials = names.length >= 2\r\n            ? `${names[0][0]}${names[names.length - 1][0]}`.toUpperCase()\r\n            : user.fullName.substring(0, 2).toUpperCase();\r\n\r\n        const primaryRole = user.roles[0] || 'No Role';\r\n\r\n        return {\r\n            ...user,\r\n            initials,\r\n            statusClass: user.isActive ? 'active' : 'inactive',\r\n            statusLabel: user.isActive ? 'Active' : 'Inactive',\r\n            primaryRole,\r\n            roleClass: this.getRoleClass(primaryRole)\r\n        };\r\n    }\r\n\r\n    private getRoleClass(role: string): string {\r\n        const roleClasses: Record<string, string> = {\r\n            'SuperAdmin': 'super-admin',\r\n            'Admin': 'admin',\r\n            'Logistics Manager': 'logistics',\r\n            'Warehouse Staff': 'warehouse',\r\n            'Support Agent': 'support',\r\n            'Finance Manager': 'finance'\r\n        };\r\n        return roleClasses[role] || 'default';\r\n    }\r\n\r\n    clearSelectedUser(): void {\r\n        this._selectedUser.set(null);\r\n    }\r\n\r\n    clearSelectedRole(): void {\r\n        this._selectedRole.set(null);\r\n    }\r\n}\r\n"],
  "mappings": "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",
  "names": []
}

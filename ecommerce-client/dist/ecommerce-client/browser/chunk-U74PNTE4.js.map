{
  "version": 3,
  "sources": ["src/app/core/guards/permission.guard.ts"],
  "sourcesContent": ["// ============================================\r\n// permission.guard.ts - Permission-based Route Protection\r\n// ============================================\r\n// Responsibilities:\r\n// - Check if user has required permissions\r\n// - Redirect to unauthorized page or dashboard\r\n// ============================================\r\n\r\nimport { inject } from '@angular/core';\r\nimport { Router, CanActivateFn, UrlTree, ActivatedRouteSnapshot } from '@angular/router';\r\nimport { TokenService } from '../services/token.service';\r\n\r\n/**\r\n * Functional guard for permission-based route protection\r\n * \r\n * Usage in routes:\r\n * {\r\n *   path: 'products/create',\r\n *   component: ProductCreateComponent,\r\n *   canActivate: [permissionGuard],\r\n *   data: { permission: 'Products.Create' }\r\n * }\r\n * \r\n * For multiple permissions (any):\r\n * data: { permissions: ['Products.Create', 'Products.Edit'], requireAll: false }\r\n * \r\n * For multiple permissions (all):\r\n * data: { permissions: ['Products.View', 'Inventory.View'], requireAll: true }\r\n */\r\nexport const permissionGuard: CanActivateFn = (route: ActivatedRouteSnapshot): boolean | UrlTree => {\r\n    const tokenService = inject(TokenService);\r\n    const router = inject(Router);\r\n\r\n    // First check if authenticated\r\n    if (!tokenService.isTokenValid()) {\r\n        return router.createUrlTree(['/login']);\r\n    }\r\n\r\n    // Get required permission(s) from route data\r\n    const singlePermission = route.data['permission'] as string | undefined;\r\n    const multiplePermissions = route.data['permissions'] as string[] | undefined;\r\n    const requireAll = route.data['requireAll'] as boolean | undefined;\r\n\r\n    // If single permission is specified\r\n    if (singlePermission) {\r\n        if (tokenService.hasPermission(singlePermission)) {\r\n            return true;\r\n        }\r\n        return router.createUrlTree(['/unauthorized']);\r\n    }\r\n\r\n    // If multiple permissions are specified\r\n    if (multiplePermissions && multiplePermissions.length > 0) {\r\n        const hasAccess = requireAll\r\n            ? tokenService.hasAllPermissions(multiplePermissions)\r\n            : tokenService.hasAnyPermission(multiplePermissions);\r\n\r\n        if (hasAccess) {\r\n            return true;\r\n        }\r\n        return router.createUrlTree(['/unauthorized']);\r\n    }\r\n\r\n    // No permissions specified - allow access (authentication is enough)\r\n    return true;\r\n};\r\n\r\n/**\r\n * Functional guard for role-based route protection\r\n * \r\n * Usage:\r\n * {\r\n *   path: 'admin',\r\n *   canActivate: [roleGuard],\r\n *   data: { role: 'Admin' }\r\n * }\r\n */\r\nexport const roleGuard: CanActivateFn = (route: ActivatedRouteSnapshot): boolean | UrlTree => {\r\n    const tokenService = inject(TokenService);\r\n    const router = inject(Router);\r\n\r\n    if (!tokenService.isTokenValid()) {\r\n        return router.createUrlTree(['/login']);\r\n    }\r\n\r\n    const requiredRole = route.data['role'] as string | undefined;\r\n    const requiredRoles = route.data['roles'] as string[] | undefined;\r\n\r\n    if (requiredRole && tokenService.hasRole(requiredRole)) {\r\n        return true;\r\n    }\r\n\r\n    if (requiredRoles && requiredRoles.some(role => tokenService.hasRole(role))) {\r\n        return true;\r\n    }\r\n\r\n    if (!requiredRole && !requiredRoles) {\r\n        return true;\r\n    }\r\n\r\n    return router.createUrlTree(['/unauthorized']);\r\n};\r\n"],
  "mappings": ";;;;;;;;;;;AA6BO,IAAM,kBAAiC,CAAC,UAAoD;AAC/F,QAAM,eAAe,OAAO,YAAY;AACxC,QAAM,SAAS,OAAO,MAAM;AAG5B,MAAI,CAAC,aAAa,aAAY,GAAI;AAC9B,WAAO,OAAO,cAAc,CAAC,QAAQ,CAAC;EAC1C;AAGA,QAAM,mBAAmB,MAAM,KAAK,YAAY;AAChD,QAAM,sBAAsB,MAAM,KAAK,aAAa;AACpD,QAAM,aAAa,MAAM,KAAK,YAAY;AAG1C,MAAI,kBAAkB;AAClB,QAAI,aAAa,cAAc,gBAAgB,GAAG;AAC9C,aAAO;IACX;AACA,WAAO,OAAO,cAAc,CAAC,eAAe,CAAC;EACjD;AAGA,MAAI,uBAAuB,oBAAoB,SAAS,GAAG;AACvD,UAAM,YAAY,aACZ,aAAa,kBAAkB,mBAAmB,IAClD,aAAa,iBAAiB,mBAAmB;AAEvD,QAAI,WAAW;AACX,aAAO;IACX;AACA,WAAO,OAAO,cAAc,CAAC,eAAe,CAAC;EACjD;AAGA,SAAO;AACX;",
  "names": []
}

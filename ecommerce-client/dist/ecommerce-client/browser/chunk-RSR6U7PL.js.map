{
  "version": 3,
  "sources": ["src/app/features/products/services/product.service.ts"],
  "sourcesContent": ["import { Injectable, inject } from '@angular/core';\r\nimport { HttpClient, HttpParams } from '@angular/common/http';\r\nimport { Observable, switchMap, tap } from 'rxjs';\r\nimport { environment } from '../../../../environments/environment';\r\nimport { LanguageService } from '../../../core/services/language.service';\r\nimport { NotificationService } from '../../../core/services/notification.service';\r\n\r\n// ============================================\r\n// DTOs matching backend Product DTOs\r\n// ============================================\r\n\r\nexport interface Product {\r\n    id: number;\r\n    sku: string;\r\n    slug: string;\r\n    name: string;\r\n    shortDescription?: string;\r\n    description?: string;\r\n    unitPrice: number;\r\n    costPrice?: number;\r\n    brandId: number;\r\n    brandName: string;\r\n    categoryId: number;\r\n    categoryName: string;\r\n    languageCode: string;\r\n    isActive: boolean;\r\n    isFeatured: boolean;\r\n    primaryImageUrl?: string;\r\n    metaTitle?: string;\r\n    metaDescription?: string;\r\n    metaKeywords?: string;\r\n    // Additional fields for product details page\r\n    images?: ProductImage[];\r\n    createdAt?: string;\r\n    // Convenience alias for unitPrice (used in templates)\r\n    price?: number;\r\n}\r\n\r\nexport interface ProductListItem {\r\n    id: number;\r\n    sku: string;\r\n    slug: string;\r\n    name: string;\r\n    shortDescription?: string;\r\n    unitPrice: number;\r\n    brandId: number;\r\n    brandName: string;\r\n    categoryId: number;\r\n    categoryName: string;\r\n    isActive: boolean;\r\n    isFeatured: boolean;\r\n    primaryImageUrl?: string;\r\n    createdAt?: string;\r\n    updatedAt?: string;\r\n}\r\n\r\nexport interface ProductListResponse {\r\n    items: ProductListItem[];\r\n    totalCount: number;\r\n    pageNumber: number;\r\n    pageSize: number;\r\n    totalPages: number;\r\n    hasPreviousPage: boolean;\r\n    hasNextPage: boolean;\r\n}\r\n\r\nexport interface ProductTranslation {\r\n    id?: number;\r\n    languageCode: string;\r\n    name: string;\r\n    shortDescription?: string;\r\n    description?: string;\r\n    metaTitle?: string;\r\n    metaDescription?: string;\r\n    metaKeywords?: string;\r\n}\r\n\r\nexport interface ProductImage {\r\n    id?: number;\r\n    imageUrl: string;\r\n    altText?: string;\r\n    displayOrder: number;\r\n    isPrimary: boolean;\r\n}\r\n\r\nexport interface CreateProductRequest {\r\n    sku: string;\r\n    slug: string;\r\n    unitPrice: number;\r\n    costPrice?: number;\r\n    brandId: number;\r\n    categoryId: number;\r\n    isFeatured: boolean;\r\n    isActive: boolean;\r\n    translations: ProductTranslation[];\r\n    images: ProductImage[];\r\n}\r\n\r\nexport interface UpdateProductRequest {\r\n    id: number;\r\n    sku: string;\r\n    slug: string;\r\n    unitPrice: number;\r\n    costPrice?: number;\r\n    brandId: number;\r\n    categoryId: number;\r\n    isFeatured: boolean;\r\n    isActive: boolean;\r\n    translations: ProductTranslation[];\r\n    images: ProductImage[];\r\n}\r\n\r\n// ============================================\r\n// Product Service\r\n// ============================================\r\n\r\n@Injectable({\r\n    providedIn: 'root'\r\n})\r\nexport class ProductService {\r\n    private readonly baseUrl = `${environment.apiUrl}/products`;\r\n    private toast = inject(NotificationService);\r\n\r\n    constructor(\r\n        private http: HttpClient,\r\n        private languageService: LanguageService\r\n    ) { }\r\n\r\n    // ----------------------------------------\r\n    // Query Operations\r\n    // ----------------------------------------\r\n\r\n    /**\r\n     * Get paginated products with optional filters\r\n     */\r\n    getPaged(\r\n        pageNumber: number = 1,\r\n        pageSize: number = 10,\r\n        search?: string,\r\n        brandId?: number,\r\n        categoryId?: number,\r\n        isActive?: boolean,\r\n        minPrice?: number,\r\n        maxPrice?: number,\r\n        sortBy?: string,\r\n        sortDescending?: boolean\r\n    ): Observable<ProductListResponse> {\r\n        let params = new HttpParams()\r\n            .set('pageNumber', pageNumber.toString())\r\n            .set('pageSize', pageSize.toString());\r\n\r\n        if (search) {\r\n            params = params.set('search', search);\r\n        }\r\n        if (brandId) {\r\n            params = params.set('brandId', brandId.toString());\r\n        }\r\n        if (categoryId) {\r\n            params = params.set('categoryId', categoryId.toString());\r\n        }\r\n        if (isActive !== undefined && isActive !== null) {\r\n            params = params.set('isActive', isActive.toString());\r\n        }\r\n        if (minPrice !== undefined) {\r\n            params = params.set('minPrice', minPrice.toString());\r\n        }\r\n        if (maxPrice !== undefined) {\r\n            params = params.set('maxPrice', maxPrice.toString());\r\n        }\r\n        if (sortBy) {\r\n            params = params.set('sortBy', sortBy);\r\n        }\r\n        if (sortDescending !== undefined) {\r\n            params = params.set('sortDescending', sortDescending.toString());\r\n        }\r\n\r\n        return this.http.get<ProductListResponse>(this.baseUrl, { params });\r\n    }\r\n\r\n    /**\r\n     * Get product by ID\r\n     */\r\n    getById(id: number): Observable<Product> {\r\n        return this.http.get<Product>(`${this.baseUrl}/${id}`);\r\n    }\r\n\r\n    /**\r\n     * Get product by slug\r\n     */\r\n    getBySlug(slug: string): Observable<Product> {\r\n        return this.http.get<Product>(`${this.baseUrl}/slug/${slug}`);\r\n    }\r\n\r\n    /**\r\n     * Get product by SKU\r\n     */\r\n    getBySku(sku: string): Observable<Product> {\r\n        return this.http.get<Product>(`${this.baseUrl}/sku/${sku}`);\r\n    }\r\n\r\n    /**\r\n     * Get featured products\r\n     */\r\n    getFeatured(count: number = 10): Observable<ProductListItem[]> {\r\n        const params = new HttpParams().set('count', count.toString());\r\n        return this.http.get<ProductListItem[]>(`${this.baseUrl}/featured`, { params });\r\n    }\r\n\r\n    /**\r\n     * Get products by brand\r\n     */\r\n    getByBrand(brandId: number): Observable<ProductListItem[]> {\r\n        return this.http.get<ProductListItem[]>(`${this.baseUrl}/brand/${brandId}`);\r\n    }\r\n\r\n    /**\r\n     * Get products by category\r\n     */\r\n    getByCategory(categoryId: number, includeSubcategories: boolean = false): Observable<ProductListItem[]> {\r\n        const params = new HttpParams()\r\n            .set('includeSubcategories', includeSubcategories.toString());\r\n        return this.http.get<ProductListItem[]>(`${this.baseUrl}/category/${categoryId}`, { params });\r\n    }\r\n\r\n    // ----------------------------------------\r\n    // Command Operations\r\n    // ----------------------------------------\r\n\r\n    /**\r\n     * Create a new product\r\n     */\r\n    create(request: CreateProductRequest): Observable<Product> {\r\n        return this.http.post<Product>(this.baseUrl, request).pipe(\r\n            tap(product => this.toast.success(`Product \"${product.name}\" created successfully`, { title: 'üõçÔ∏è Product Created' }))\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Update an existing product\r\n     */\r\n    update(id: number, request: UpdateProductRequest): Observable<Product> {\r\n        return this.http.put<Product>(`${this.baseUrl}/${id}`, request).pipe(\r\n            tap(() => this.toast.success('Product updated successfully', { title: '‚úÖ Product Updated' }))\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Delete a product (soft delete by default)\r\n     */\r\n    delete(id: number, hardDelete: boolean = false): Observable<void> {\r\n        const params = new HttpParams().set('hardDelete', hardDelete.toString());\r\n        return this.http.delete<void>(`${this.baseUrl}/${id}`, { params }).pipe(\r\n            tap(() => this.toast.warning('Product deleted', { title: 'üóëÔ∏è Product Deleted' }))\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Toggle product active status\r\n     */\r\n    toggleStatus(id: number, isActive: boolean): Observable<void> {\r\n        return this.http.patch<void>(`${this.baseUrl}/${id}/status`, { isActive });\r\n    }\r\n\r\n    // ----------------------------------------\r\n    // Translation Operations\r\n    // ----------------------------------------\r\n\r\n    /**\r\n     * Add or update a translation\r\n     */\r\n    upsertTranslation(productId: number, translation: ProductTranslation): Observable<ProductTranslation> {\r\n        return this.http.put<ProductTranslation>(\r\n            `${this.baseUrl}/${productId}/translations/${translation.languageCode}`,\r\n            translation\r\n        );\r\n    }\r\n\r\n    // ----------------------------------------\r\n    // Image Operations\r\n    // ----------------------------------------\r\n\r\n    /**\r\n     * Add an image to a product\r\n     */\r\n    addImage(productId: number, image: ProductImage): Observable<ProductImage> {\r\n        return this.http.post<ProductImage>(`${this.baseUrl}/${productId}/images`, image);\r\n    }\r\n\r\n    /**\r\n     * Update a product image\r\n     */\r\n    updateImage(productId: number, imageId: number, image: ProductImage): Observable<ProductImage> {\r\n        return this.http.put<ProductImage>(`${this.baseUrl}/${productId}/images/${imageId}`, image);\r\n    }\r\n\r\n    /**\r\n     * Delete a product image\r\n     */\r\n    deleteImage(productId: number, imageId: number): Observable<void> {\r\n        return this.http.delete<void>(`${this.baseUrl}/${productId}/images/${imageId}`);\r\n    }\r\n\r\n    /**\r\n     * Set primary image\r\n     */\r\n    setPrimaryImage(productId: number, imageId: number): Observable<void> {\r\n        return this.http.patch<void>(`${this.baseUrl}/${productId}/images/${imageId}/primary`, {});\r\n    }\r\n\r\n    // ----------------------------------------\r\n    // Language Helper\r\n    // ----------------------------------------\r\n\r\n    /**\r\n     * Reload products when language changes\r\n     */\r\n    getPagedWithLanguageReload(\r\n        pageNumber: number = 1,\r\n        pageSize: number = 10,\r\n        search?: string,\r\n        brandId?: number,\r\n        categoryId?: number,\r\n        isActive?: boolean\r\n    ): Observable<ProductListResponse> {\r\n        return this.languageService.currentLanguage$.pipe(\r\n            switchMap(() => this.getPaged(pageNumber, pageSize, search, brandId, categoryId, isActive))\r\n        );\r\n    }\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
